---
    - name: Make sure that we can connect to the machine
      ping:
    
    - name: install openjdk
      yum: name=java-1.8.0-openjdk-devel  state=present

    - name: add group "tomcat"
      group: name=tomcat

    - name: add user "tomcat"
      user: name=tomcat group=tomcat createhome=no
      become: true

    - name: ansible create directory example
      file:  path=/opt/tomcat  owner=tomcat group=tomcat state=directory mode=0777 recurse=yes
      
    - name: Download foo.conf
      get_url:
        url: https://downloads.apache.org/tomcat/tomcat-8/v8.5.56/bin/apache-tomcat-8.5.56.tar.gz
        dest: /opt/tomcat
   
  #- name: Change file ownership, group and permissions
   #   file:
   #     path: /opt/tomcat/apache-tomcat-8.5.56.tar.gz
   #     owner: centos
   #     group: centos
    #    mode: '0777'
   
    - name: Extract Tomcat archive
      unarchive: src=/opt/tomcat/apache-tomcat-8.5.56.tar.gz dest=/opt/tomcat remote_src=yes

    - name: change ownership 
      file: path=/opt/tomcat/apache-tomcat-8.5.56 state=directory recurse=yes owner=centos group=centos mode=0755
 


    - name: Start Tomcat
      command: nohup /opt/tomcat/apache-tomcat-8.5.56/bin/startup.sh
      become: true
      become_user: root

    - name: cloning git repo
      git: repo=https://github.com/krishnamaram2/binary-code.git
           dest=/home/centos/binary-code


    - name: deploy war file in webapps diretcory
      copy:  src=/home/centos/binary-code/binaries/Student.war dest=/opt/tomcat/apache-tomcat-8.5.56/webapps/

    - name: Start Tomcat
      command: nohup /opt/tomcat/apache-tomcat-8.5.56/bin/startup.sh
      become: true
      become_user: root
   
    - name: change ownership 
      file: path=/opt/tomcat/apache-tomcat-8.5.56/webapps/Student state=directory recurse=yes owner=centos group=centos mode=0755
    
    - name: changge localhost in application.properties file
      replace:
          path: /opt/tomcat/apache-tomcat-8.5.56/webapps/Student/WEB-INF/classes/application.properties
          regexp: 'localhost'
          replace: '18.235.255.3'


    - name: commenting a line in server.xml
      replace:
           path: /opt/tomcat/apache-tomcat-8.5.56/conf/server.xml
           regexp: '<Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
               prefix="localhost_access_log" suffix=".txt"
               pattern="%h %l %u %t &quot;%r&quot; %s %b" />'
           replace: '<!-- <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
               prefix="localhost_access_log" suffix=".txt"
               pattern="%h %l %u %t &quot;%r&quot; %s %b" />-->'


#    - name: Start Tomcat
 #     command: nohup /opt/tomcat/apache-tomcat-8.5.56/bin/startup.sh
  #    become: true
   #   become_user: root

    #- name: change ownership 
    #  file: path=/opt/tomcat/apache-tomcat-8.5.56 state=directory recurse=yes owner=centos group=centos mode=0755
#    - name: changge localhost in application.properties file
#      replace:
#        path: /opt/tomcat/apache-tomcat-8.5.56/webapps/Student/WEB-INF/classes/application.properties
 #       regexp: 'localhost'
 #       replace: '100.27.12.204'

  #  - name: change localhost in application.properties file
   #   replace:
    #       path: /opt/tomcat/apache-tomcat-8.5.56/webapps/Student/WEB-INF/classes/application.properties
     #      regexp: 'localhost'
      #     replace: '100.27.12.204'
